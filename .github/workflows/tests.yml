name: tests
on:
   push:
      branches: [ "main", "develop" ]
   pull_request:
      branches: [ "main" ]
      
jobs:
   build_job:
      runs-on: ubuntu-latest
      
      steps:
        - name: checkout
          uses: actions/checkout@v4
          with:
            submodules: true

        - uses: actions/cache@v3
          with:
            path: vcpkg
            key: ${{ runner.os }}-vcpkg-${{ hashFiles('./vcpkg/downloads/*.tar.gz') }}
            restore-keys: ${{ runner.os }}-vcpkg-

        - name: installing
          run: sudo apt install cmake make g++ clang-tidy

        - name: configuring
          run: cmake -S . -B build

        - name: building
          run: cmake --build build

        - name: testing
          run: ctest -VV --test-dir build/tests
